#!/usr/bin/env php
<?php
require_once(__DIR__ . '/../src/Dotfiles.php');
$dotfiles = new TJM\Dotfiles\Dotfiles();
$path = $dotfiles->getBaseDir();
if(substr($path, 0, 1) === '~'){
	$path = str_replace('~', $_SERVER['HOME'], $path);
}
$cmd = $argv[1] ?? null;
if((!$cmd && file_exists($path)) || $cmd === 'update'){
	echo "updating dotfiles\n";
	chdir($path);
	passthru('git pull');
}elseif(!file_exists($path) || $cmd === 'init' || $cmd === 'install'){
	echo "placing all dotfiles\n";
	$dotfiles->placeAllFiles();
}else{
	throw new Exception("Unknown command");
}
